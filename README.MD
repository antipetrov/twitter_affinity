# Загрузка твитов

Для загрузки твитов из файла нужно запустить скрипт

`python twitter_parse.py `

Параметры:

"-f", "--tweetfile" - путь к json-файлу с твитами, по-умолчанию './three_minutes_tweets.json.txt'

"-d", "--dbfile" - путь к файлу БД sqlite, по-умолчанию "./tweets.db"

"-с" "--cleanup" - удалить данные из БД (drop table) перед загрузкой, по-умолчанию False

"-v", "--verbose" - расширенный вывод в stdout, по-умолчанию False

Данные записываются в таблицу tweets, если таблицы в БД нет, она создается.

Базовые тесты парсера - test_parser.py


# SQL-Скрипт нормализации загруженных данных

`normalize.sql`

Изначальная таблица tweets разбивается на 2 - tweets_post, tweets_user


# Подсчет tweet_sentiment

Для подсчета требуется чтобы скрипт нормализации уже применен и данные лежали в двух таблицах -- tweets_post, tweets_user

Для подсчета tweet_sentiment нужно запустить 

`python calc_sentiment.py `

"-a", "--afinnfile" - путь к AFINN-файлу, по-умолчанию "./AFINN-111.txt"

"-d", "--datafile" - путь к файлу БД sqlite, по-умолчанию "./tweets.db"

"-v", "--verbose" - расширенный вывод в stdout, по-умолчанию False

# Вывод статистики по счастливым\несчастным странам-локациям-пользователям

Select-запрос - в файле `aggregates.sql`

Колонки: 

- `most_happy_user` - самый счастливый пользователь
- `least_happy_user` - самый несчастный пользователь
- `most_happy_country` - самая счастливая страна
- `least_happy_country` - самая несчастная страна
- `most_happy_location` - самый счастливый location
- `least_happy_location`  - самый несчастный location


# Схема ETL-пайплайна 

Предлагаю следующую схему ежедневной переоценки статистики счастья\несчастья

1. Выгрузить новый tweets.txt с ftp-сервера (python-скриптом).

2. Python-скриптом разобрать каждый твитиз tweets.txt - извлечь нужные поля, в том же цикле для каждого твита вычислить `tweet_sentiment`. 

3. Разобранные на шаге 2 поля записать в БД (не SQLite, а скорее mysql\postgres). Чтобы предотвратить дублирование твитов, обязательно извлекать поле `id` твита и записывать его в таблицу твитов в поле с unique-индексом.

4. Средствами SQL пересчитать рейтинги счастья\несчастья и записать их в итоговый файл, итоговый файл закачать в результирующий ftp-сервер

